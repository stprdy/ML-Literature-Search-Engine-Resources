brain tissue segmentation across human lifespan via supervised contrastive learning xiaoyang chen jinjian wu wenjiao lyu yicheng zou thung siyuan liu ye wu sahar ahmad yap department radiology biomedical research imaging center bric university north carolina chapel hill nc usa ptyap abstract automatic segmentation brain mr image white ter wm gray matter gm cerebrospinal ﬂuid csf critical tissue volumetric analysis cortical surface reconstruction due matic structural appearance change associated developmental aging process existing brain tissue segmentation method only viable speciﬁc age group consequently method developed one age group may fail another paper make ﬁrst attempt segment brain tissue across entire human lifespan 0 year age using uniﬁed deep learning model overcome challenge related structural variability underpinned biological process tensity inhomogeneity motion artifact diﬀerences acquisition protocol propose use contrastive learning improve quality feature representation latent space eﬀective pan tissue segmentation compared approach commonly used segmentation method dataset mr image experimental result show model accurately segment brain sue across lifespan outperforms existing method 1 introduction segmentation gray matter gm white matter wm cerebrospinal ﬂuid csf magnetic resonance mr image prerequisite delineating brain anatomical structure quantifying change tissue volume cortical geometry relation development aging manual brain tissue mentation carried expert laborious sensitive variability therefore eﬀective automated segmentation approach brain tissue highly desirable although commonly employed segmentation method including spm 1 freesurfer 3 fsl 14 eﬀective delineating brain tissue tailored adult mr image method le eﬀective segmenting infant brain mr image due dynamic morphological appearance change caused developmental process ﬁrst year birth cater unique characteristic infant brain developing human nectome project dhcp processing pipeline 7 infant freesurfer 15 3 jan 2023 2 chen et al developed segmentation method warp ually segmented atlas target image using registration method however accurate segmentation ﬁne structure remains diﬃcult due large anatomical variability leading result inaccurate segmentation cause problem reconstruction cortical surface need ing cortical morphology cortical thickness surface area curvature deep neural network dnns successfully used brain tissue segmentation example roy et al 10 ﬁrst pretrained model iary label large unlabeled dataset using freesurfer model limited manually labeled data like freesurfer method tive only adult image nie et al 9 trained multiple model designed diﬀerent imaging modality segment image particularly isointense phase month age method tailored speciﬁc age group not generalizable age group paper propose novel brain tissue segmentation method applicable across entire human lifespan 0 year age designing uniﬁed model take account developmental aging related tural contrast change brain mr image fig 1 challenging moreover common imaging issue noise intensity inhomogeneity partial volume eﬀects artifact acquisition protocol complicate model design address problem propose use supervised contrastive learning learn discriminative feature representation robust intensity ences imaging imperfection key contribution work follows propose dented lifespan segmentation method based single deep learning model ii use novel supervised contrastive learning strategy regularize network training learn discriminative feature robust structural tissue contrast change driven biological mechanism inconsistent acquisition tocols imaging imperfection iii demonstrate large dataset brain mr image eﬀectiveness method 2 method supervised contrastive learning despite architecture diﬀerences deep learning segmentation model share two main component feature extractor fe ii classiﬁer medical age segmentation fe usually ha architecture enable segmentation fe used learn feature sentations classiﬁer usually implemented one 1 1 1 convolutional layer used perform classiﬁcation taking feature representation learned fe input previous approach ically jointly learn fe classiﬁer via loss function categorical however joint learning scheme unable learn discriminative feature 13 result margin feature cluster diﬀerent lifespan brain tissue segmentation 3 10 day b 5 month c 9 month 1 year e 32 year f 100 year fig 1 brain morphology tissue contrast vary across human lifespan label narrow leading classiﬁers model sensitive noise artifact intensity contrast change inspired success momentum contrast moco 5 learning approach instance discrimination adopt similar contrastive learning strategy learn discriminative feature unlike moco contrastive learning used unsupervised perform contrastive learning supervised manner key idea contrastive learning pull feature representation class close together push diﬀerent class far apart latent space end use memory bank store typical feature representation proxy semantic category noted using proxy feasible making comparison around million voxels involved training step case otherwise problem becomes intractable implement contrastive learning cosine larity feature representation proxy memory bank computed contrastive loss infonce calculated use label given voxel guidance select positive negative proxy memory bank therefore call training strategy supervised contrastive learning use memory bank shape c number semantic category number proxy category dimensionality proxy note identical number channel last layer fe memory bank trainable adaptively learned optimized via training proxy memory bank 4 chen et al act positive proxy query feature representation voxel share label otherwise used negative proxy calculating contrastive loss contrastive loss arbitrary query qi deﬁned li ctr log sim qi sim qi sim qi 1 sim u v cosine similarity τ temperature qi feature representation query voxel index set positive negative proxy qi respectively size set equal c respectively joint feature regularization classiﬁcation addition li ctr feature regularization categorical loss li ce used joint training overall loss function li total query voxel weighted sum li ce li ctr balanced λctr formally deﬁned li total li ce λctrli ctr 2 li ce c yic log ˆ pic 3 3 ˆ pic element output probability vector query voxel yic taking either 0 1 ground truth value ˆ pic learning imbalanced data class imbalance issue common brain tissue segmentation image level volume gm wm usually 2 time larger csf three tissue considerably smaller background region region not gm wm csf level class imbalance issue even severe since image patch expected contain only voxels one class solve class imbalance issue using two diﬀerent approach ﬁrst approach use stratiﬁed sampling instead randomly taking sample whole image region ﬁrst derive minimum bounding box tissue type using ground truth label map randomly take equal number sample image patch bounding box simplicity allow overlapped bounding box second approach select equal number sample class present loss computation due randomness sampling label set l given only subset positive integer represent foreground class label lifespan brain tissue segmentation 5 0 denotes background ﬁrst count number voxels category l obtain minimum nmin min nc nc number sample class c randomly select nmin sample category present compute loss sample ﬁnal loss average loss selected sample implementation detail implemented proposed method kera tensorflow backend used variant feature extractor contrast original 8 removed original head classiﬁcation ii adjusted size convolutional kernel 5 3 lower risk overﬁtting iii used instance normalization 11 convolutional layer suitable small batch size used simple perceptron mlp consisting three 1 1 1 convolutional layer classiﬁer mlp ﬁrst two convolutional layer followed rectiﬁed linear unit relu last one followed softmax layer used adam optimizer initial learning rate update parameter convolutional kernel memory bank randomly initialized bias term initialized patch size wa set 80 80 80 batch size 2 3 experimental result dataset dataset consists image pair ﬁve lifespan man connectome project developing human connectome project dhcp gestational age 37 44 week 7 ii baby connectome project bcp age 0 5 year 6 iii hcp development age 6 22 year iv hcp young adult age 22 37 year v hcp aging age 36 100 year total image pair used 682 used training 113 validation rest testing among image used training manually annotated 62 image set tissue segmentation map remaining 620 image uncorrected set tained using standard hcp minimal preprocessed pipeline set includes 31 image bcp 20 7 4 since number image set much smaller uncorrected set take half training sample set half uncorrected set make sure model not ased uncorrected label testing used dice similarity coeﬃcient dsc average surface distance asd metric performance evaluation experimental setup compared proposed method vanilla 8 variant mlp classiﬁcation head variant 6 chen et al table 1 comparison dsc asd testing set various method method dsc asd mm gm wm csf gm wm csf 8 variant proposed table 2 comparison dsc asd testing set diﬀerent input modality dsc asd mm gm wm csf gm wm csf proposed method diﬀer variant wa trained categorical ce loss only result main result experimental result shown table vanilla net only achieves dsc gm wm csf respectively compared vanilla variant icantly improves performance gm wm csf respectively p proposed supervised contrastive ing strategy applied method improves dsc gm wm csf respectively variant notably improvement csf much larger gm wm gm wm majority class segmented satisfactorily however accurate csf segmentation key ensure topological correctness reconstructing pial surface single modality studied performance proposed method only either image input experimental result shown table compared performance paired image input segmentation performance decrease marginally ranging dsc image provide tary information help improve brain tissue segmentation however marginal decrease indicates model learn eﬀectively limited mation growth modeling tissue volume modeled growth trajectory dicted tissue volume using generalized additive mixture model gamm ﬁtted gamm volume tissue type across lifespan cubic regression spline smooth nonlinear function age dom intercept growth trajectory shown fig 2 indicate gm lifespan brain tissue segmentation 7 wm volume exhibit pattern whereas csf volume increase throughout lifespan surface reconstruction fig 3 show example surface tissue mentation map generated using method various time point across human lifespan general result indicate good segmentation detail ularly cortex evidenced detailed surface convolution clear gryi sulcus jh 0 birth 2 1 5 8 16 3560 100 age year log scale 50 250 450 650 850 gm volume jh birth 2 1 5 8 16 3560 100 age year log scale 50 250 450 650 wm volume jh 6 birth 2 1 5 8 16 3560 100 age year log scale 0 200 400 600 csf volume fig 2 growth trajectory tissue volume across human lifespan 1 year 10 year 75 year 6 month white surface pial surface tissue overlay fig 3 reconstructed white pial surface tissue segmentation map 4 diﬀerent time point 8 chen et al ablation study impact using balanced loss studied impact selecting equal number voxels diﬀerent category compute ce contrastive loss shown table 3 balancing contribution diﬀerent class critical better segmentation minority class csf table 3 impact balanced loss dsc gm wm csf unbalanced balanced impact λctr ﬁxed 10 τ tried λctr shown table 4 performance marginally changed using diﬀerent λctr table 4 impact λctr dsc gm wm csf gm wm csf dsc impact τ ﬁxed λctr 1 found performance insensitive choice λctr shown table 5 larger smaller τ seem generate better result consistent 2 found larger number negative sample beneﬁcial contrastive learning table 5 impact τ dsc τ 5 10 4 conclusion presented novel supervised contrastive learning method brain tissue segmentation across human lifespan experimental result large dataset show method eﬀectively segment tissue paired image image lifespan brain tissue segmentation 9 acknowledgement work wa supported part united state national institute health nih grant data provided part developing human connectome project sortium funded european research council european union seventh framework programme erc grant agreement no data provided part human connectome project minn consortium principal investigator david van essen kamil ugurbil funded 16 nih institute center support nih blueprint neuroscience research mcdonnell center tems neuroscience washington university reference ashburner friston uniﬁed segmentation neuroimage 26 3 2005 chen kornblith norouzi hinton simple framework trastive learning visual representation international conference machine learning pp pmlr 2020 fischl salat busa albert dieterich haselgrove van der kouwe killiany kennedy klaveness et al whole brain mentation automated labeling neuroanatomical structure human brain neuron 33 3 2002 glasser sotiropoulos wilson coalson fischl sson xu jbabdi webster polimeni et al minimal preprocessing pipeline human connectome project neuroimage 80 124 2013 fan wu xie girshick momentum contrast unsupervised visual representation learning proceeding conference computer vision pattern recognition pp 2020 howell styner gao yap wang baluyot yacoub chen potts salzwedel et al baby connectome project bcp overview study design protocol development roimage 185 2019 makropoulos robinson schuh wright fitzgibbon bozek counsell steinweg vecchiato et al developing human connectome project minimal processing pipeline neonatal cortical surface reconstruction neuroimage 173 2018 milletari navab ahmadi fully convolutional neural network volumetric medical image segmentation international conference vision pp ieee 2016 nie wang gao shen fully convolutional network modality isointense infant brain image segmentation ieee international posium biomedical imaging isbi pp 2016 roy conjeti navab wachinger quicknat fully convolutional network quick accurate segmentation neuroanatomy neuroimage 186 2019 10 chen et al ulyanov vedaldi lempitsky instance normalization missing gredient fast stylization arxiv preprint 2016 van essen ugurbil auerbach barch behrens bucholz chang chen corbetta curtis della penna feinberg glasser harel heath marcus michalareas moeller oostenveld petersen prior schlaggar smith der xu yacoub human connectome project data acquisition perspective neuroimage 62 4 2222 2231 2012 wen zhang li qiao discriminative feature learning approach deep face recognition european conference computer vision pp springer 2016 zhang brady smith segmentation brain mr image hidden markov random ﬁeld model algorithm ieee transaction medical imaging 20 1 2001 ollei iglesias ou grant fischl infant freesurfer mated segmentation surface extraction pipeline neuroimaging data infant year neuroimage 218 116946 2020